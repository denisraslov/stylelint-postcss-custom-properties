{"version":3,"file":"index.es.mjs","sources":["lib/get-custom-properties-from-root.js","lib/get-custom-properties-from-imports.js","index.js"],"sourcesContent":["// return custom selectors from the css root, conditionally removing them\nexport default root => {\n\t// initialize custom selectors\n\tconst customProperties = {};\n\n\t// for each custom property declaration\n\troot.walkDecls(customPropertyRegExp, decl => {\n\t\tconst { prop } = decl;\n\n\t\t// write the parsed value to the custom property\n\t\tcustomProperties[prop] = decl.value;\n\t});\n\n\t// return all custom properties, preferring :root properties over html properties\n\treturn customProperties;\n};\n\n// match custom properties\nconst customPropertyRegExp = /^--[A-z][\\w-]*$/;\n","import fs from 'fs';\nimport path from 'path';\nimport postcss from 'postcss';\nimport getCustomPropertiesFromRoot from './get-custom-properties-from-root';\n\n/* Get Custom Properties from CSS File\n/* ========================================================================== */\n\nasync function getCustomPropertiesFromCSSFile(from) {\n\tconst css = await readFile(from);\n\tconst root = postcss.parse(css, { from });\n\n\treturn getCustomPropertiesFromRoot(root);\n}\n\n/* Get Custom Properties from Object\n/* ========================================================================== */\n\nfunction getCustomPropertiesFromObject(object) {\n\tconst customProperties = Object.assign(\n\t\t{},\n\t\tObject(object).customProperties,\n\t\tObject(object)['custom-properties']\n\t);\n\n\treturn customProperties;\n}\n\n/* Get Custom Properties from JSON file\n/* ========================================================================== */\n\nasync function getCustomPropertiesFromJSONFile(from) {\n\tconst object = await readJSON(from);\n\n\treturn getCustomPropertiesFromObject(object);\n}\n\n/* Get Custom Properties from JS file\n/* ========================================================================== */\n\nasync function getCustomPropertiesFromJSFile(from) {\n\tconst object = await import(from);\n\n\treturn getCustomPropertiesFromObject(object);\n}\n\n/* Get Custom Properties from Sources\n/* ========================================================================== */\n\nexport default function getCustomPropertiesFromSources(sources) {\n\treturn sources.map(source => {\n\t\tif (source instanceof Promise) {\n\t\t\treturn source;\n\t\t} else if (source instanceof Function) {\n\t\t\treturn source();\n\t\t}\n\n\t\t// read the source as an object\n\t\tconst opts = source === Object(source) ? source : { from: String(source) };\n\n\t\t// skip objects with Custom Properties\n\t\tif (opts.customProperties || opts['custom-properties']) {\n\t\t\treturn opts\n\t\t}\n\n\t\t// source pathname\n\t\tconst from = path.resolve(String(opts.from || ''));\n\n\t\t// type of file being read from\n\t\tconst type = (opts.type || path.extname(from).slice(1)).toLowerCase();\n\n\t\treturn { type, from };\n\t}).reduce(async (customProperties, source) => {\n\t\tconst { type, from } = await source;\n\n\t\tif (type === 'css') {\n\t\t\treturn Object.assign(await customProperties, await getCustomPropertiesFromCSSFile(from));\n\t\t}\n\n\t\tif (type === 'js') {\n\t\t\treturn Object.assign(await customProperties, await getCustomPropertiesFromJSFile(from));\n\t\t}\n\n\t\tif (type === 'json') {\n\t\t\treturn Object.assign(await customProperties, await getCustomPropertiesFromJSONFile(from));\n\t\t}\n\n\t\treturn Object.assign(await customProperties, await getCustomPropertiesFromObject(await source));\n\t}, {});\n}\n\n/* Promise-ified utilities\n/* ========================================================================== */\n\nconst readFile = from => new Promise((resolve, reject) => {\n\tfs.readFile(from, 'utf8', (error, result) => {\n\t\tif (error) {\n\t\t\treject(error);\n\t\t} else {\n\t\t\tresolve(result);\n\t\t}\n\t});\n});\n\nconst readJSON = async from => JSON.parse(await readFile(from));\n","import stylelint from 'stylelint';\nimport getCustomPropertiesFromRoot from './lib/get-custom-properties-from-root';\nimport getCustomPropertiesFromImports from './lib/get-custom-properties-from-imports';\n\nconst ruleName = 'plugin/postcss-custom-properties';\n\nfunction isCustomPropertyDecl(prop) {\n  return prop.includes('--');\n}\n\nfunction prepareValue(value) {\n  if (typeof value === 'string') {\n    value = value.toUpperCase();\n  }\n\n  return value;\n}\n\nfunction foundCustomPropertyInValue(properies, value) {\n  value = prepareValue(value);\n\n  for (let i in properies) {\n    const property = prepareValue(properies[i]);\n\n    if (value.includes(property)) return i;\n  }\n}\n\nasync function getCustomProperties(root, importFrom) {\n  // all custom properties from the file and imports\n  return Object.assign(\n    {},\n    await getCustomPropertiesFromImports(importFrom),\n    getCustomPropertiesFromRoot(root)\n  );\n}\n\nfunction checkDeclOnCustomProperty(decl, customProperties, result) {\n  const foundVariable = foundCustomPropertyInValue(customProperties, decl.value);\n\n  if (foundVariable) {\n    stylelint.utils.report({\n      ruleName,\n      result,\n      node: decl,\n      message: 'The value (or a part of it) should be presented as a custom property: \"' + \n        decl.value + '\" is \"' + foundVariable + '\" (' + ruleName + ')'\n    });\n  }\n}\n\nmodule.exports = stylelint.createPlugin(ruleName, function(options) {\n  return async function(root, result) {\n    const importFrom = options && options.importFrom ? options.importFrom : [];\n    const customProperties = await getCustomProperties(root, importFrom);\n\n    root.walkRules(function(rule) {\n      rule.walkDecls(function(decl) {\n        // Skip custom properties declarations\n        if (!isCustomPropertyDecl(decl.prop)) {\n          checkDeclOnCustomProperty(decl, customProperties, result);\n        }\n      });\n    });\n  }\n});"],"names":["root","customProperties","walkDecls","customPropertyRegExp","decl","prop","value","getCustomPropertiesFromCSSFile","from","css","readFile","postcss","parse","getCustomPropertiesFromRoot","getCustomPropertiesFromObject","object","Object","assign","getCustomPropertiesFromJSONFile","readJSON","getCustomPropertiesFromJSFile","getCustomPropertiesFromSources","sources","map","source","Promise","Function","opts","String","path","resolve","type","extname","slice","toLowerCase","reduce","reject","fs","error","result","JSON","ruleName","isCustomPropertyDecl","includes","prepareValue","toUpperCase","foundCustomPropertyInValue","properies","i","property","getCustomProperties","importFrom","getCustomPropertiesFromImports","checkDeclOnCustomProperty","foundVariable","stylelint","utils","report","node","message","module","exports","createPlugin","options","walkRules","rule"],"mappings":"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"}